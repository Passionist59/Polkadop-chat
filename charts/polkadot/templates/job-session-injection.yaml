{{ if .Values.validator }}
apiVersion: batch/v1
kind: Job
metadata:
  name: {{ include "polkadot-deployer.sessionInjectionName" . }}
  namespace: {{ .Values.namespace }}
spec:
  template:
    spec:
      serviceAccountName: {{ include "polkadot-deployer.sessionInjectionName" . }}
      containers:
      - name: {{ include "polkadot-deployer.sessionInjectionName" . }}
        image: {{ .Values.initImage.repo }}:{{ .Values.initImage.tag }}
        command:
        - /app/inject_session_keys.sh
        - {{ include "polkadot-deployer.rpcService" . }}:{{ .Values.rpcPort }}
        - {{ include "polkadot-deployer.statefulsetName" . }}
        volumeMounts:
        - name: session-keys
          mountPath: /keys
      restartPolicy: Never
      volumes:
      - name: session-keys
        secret:
          secretName: {{ include "polkadot-deployer.sessionKey" . }}
          defaultMode: 256
          items:
          - key: grandpa-session-key
            path: grandpa-session
          - key: babe-session-key
            path: babe-session
          - key: imonline-session-key
            path: imonline-session
  backoffLimit: 4
{{ end }}
